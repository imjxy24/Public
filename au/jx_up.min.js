const MAX_FILE_SIZE=1073741824,CHUNK_SIZE=5242880,fileInput=document.getElementById("fileInput"),progressBar=document.querySelector("#uploadModal .progress-bar"),progressContainer=document.querySelector("#uploadModal .progress"),uploadForm=document.getElementById("uploadForm"),uploadModalElement=document.getElementById("uploadModal"),uploadModal=new bootstrap.Modal(uploadModalElement),fileInfo=document.getElementById("fileInfo"),fileNameSpan=document.getElementById("fileName"),fileIdSpan=document.getElementById("fileId"),copyLinkBtn=document.getElementById("copyLink"),warningMessage=document.getElementById("warningMessage");function allowDrop(e){e.preventDefault()}function dropHandler(e){e.preventDefault();let l;if(e.dataTransfer.items){for(let t=0;t<e.dataTransfer.items.length;t++)if("file"===e.dataTransfer.items[t].kind){l=e.dataTransfer.items[t].getAsFile();break}}else l=e.dataTransfer.files[0];l?l.size<=1073741824?uploadFile(l):alert("File size exceeds the limit of 1GB. Please choose a smaller file."):alert("No valid file was dropped.")}uploadModalElement.addEventListener("hidden.bs.modal",function(){uploadForm.reset(),progressBar.style.width="0%",progressBar.textContent="0%",fileInfo.style.display="none",progressContainer.style.display="block",warningMessage.style.display="none"});const browseLink=document.querySelector(".browse-link");async function uploadFile(e){if(e.size>1073741824){alert("File size exceeds the limit of 1GB. Please choose a smaller file.");return}uploadModal.show(),fileInfo.style.display="none",progressContainer.style.display="block",warningMessage.style.display="none";let l=Math.ceil(e.size/5242880),t=generateId(8);for(let a=0;a<l;a++){let n=e.slice(5242880*a,(a+1)*5242880),o=new FormData;o.append("chunk",n),o.append("index",a),o.append("totalChunks",l),o.append("fileName",e.name),o.append("fileId",t);try{let i=await fetch("https://jx.jxfiles.me/upload",{method:"POST",body:o}),r=await i.json();if(!r.ok)throw Error(r.err);let s=Math.round((a+1)/l*100);progressBar.style.width=`${s}%`,progressBar.setAttribute("aria-valuenow",s),progressBar.textContent=`${s}%`,a===l-1&&(console.log("File uploaded successfully"),fileNameSpan.textContent=e.name,fileIdSpan.textContent=t,fileInfo.style.display="block",progressContainer.style.display="none",warningMessage.textContent="Please wait at least 15 minutes before sharing the link. In the meantime, our server will make the file more secure.",warningMessage.style.display="block")}catch(d){console.error("Error uploading chunk:",d),alert("Error uploading file. Please try again.");break}}}function generateId(e){let l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t="",a=l.length;for(let n=0;n<e;n++)t+=l.charAt(Math.floor(Math.random()*a));return t.toLowerCase()}browseLink.addEventListener("click",()=>{fileInput.click()}),fileInput.addEventListener("change",()=>{let e=fileInput.files[0];e&&(e.size<=1073741824?uploadFile(e):(alert("File size exceeds the limit of 1GB. Please choose a smaller file."),fileInput.value=""))}),copyLinkBtn.addEventListener("click",()=>{let e=fileIdSpan.textContent,l=`https://jx.jxfiles.me/${e}`;navigator.clipboard.writeText(l).then(()=>{alert("Link copied to clipboard!")}).catch(e=>{console.error("Failed to copy link: ",e),alert("Failed to copy link. Please try again.")})}),window.onbeforeunload=()=>{uploadForm.reset()};
